IPv4의 4바이트 주소 체계는 휴대전화, 노트북의 보급량이 증가함에 따라 주소 고갈 문제를 겪고 있다.

이에 따라 네트워크 엔지니어들은 더 이상 고갈되지 않게 사용할 수 있는 새로운 체계를 찾아야 했고, 새롭게 나온 프로토콜이 바로 `IPv6`다.

하지만 아직 IPv4를 사용하고 있는 컴퓨터들이 대부분이기 때문에, 이들의 호환성을 유지시키면서 (역방향 호환성) 새로운 주소 체계로의 천이가 가능했어야 했다.

- 천이(Transition) : 공학적 상태 변화

---

# 🎯IPv6

- IPv6 주소는 128비트(16바이트) 길이를 갖는다.
- 이는 IPv4 주소 길이의 4배다.

> 길이가 4배라는 것이지 사용 가능한 주소 수가 4배 늘었다는 것은 아니다.
- 사용 가능 주소는 2^96 배 증가했다.
- 이는 전 세계 1 제곱 미터당 1개의 IP 주소를 사용해도 몇 조/경 개가 남는 양이다..

![](https://velog.velcdn.com/images/alstjr971/post/72b95dd3-83f5-49f0-9d09-ea356a41dc08/image.png)


### 표기법

1. 콜론 16진 표기법
![](https://velog.velcdn.com/images/alstjr971/post/980cc067-2089-4429-8a05-a4b140d4f5aa/image.png)

2. 제로 압축
![](https://velog.velcdn.com/images/alstjr971/post/79b91f9a-661f-4084-8227-5f7f7cc08d78/image.png)


3. CIDR 주소

![](https://velog.velcdn.com/images/alstjr971/post/ba39ce3b-a484-470d-aaff-e4df84ab203b/image.png)

## 🔹세 가지 주소 유형

**IPv6에서 목적지 주소는 세 가지 유형 중 하나다.**

1. 🔸유니캐스트
  - 단일 인터페이스
  - 특정 수신자로 전달
2. 🔸멀티캐스트
  - 컴퓨터의 그룹
  - 그룹의 각 멤버가 하나의 복사본을 수신
  - IPv6는 멀티캐스팅을 위해 `블록`을 지정해 사용함
3. 🔸애니캐스트
  - 애니캐스트는 처음 보는 개념이므로, 자세히 알아보자.

> 왜 브로드캐스트는 없는가?
- IPv6는 브로드캐스트를 멀티캐스트의 특수 형태로 본다.

### 🔶 애니캐스트

![](https://velog.velcdn.com/images/alstjr971/post/de45b7da-07dd-4394-ba9a-e962d8b48652/image.png)

**애니캐스트 주소는 `단일 주소를 공유`하는 컴퓨터들의 그룹을 정의한다.**

애니캐스트 주소를 가진 패킷은 그룹의 멤버 중에서, `가장 접근이 쉬운` 오직 하나의 멤버에게만 전달된다.

🔥예제

- 질의에 응답할 수 있는 여러 개의 서버가 있는 경우, 애니캐스트 통신이 사용된다.
- 요청은 가장 접근이 쉬운 서버로 송신된다.
- 하드웨어와 소프트웨어는 요청에 대해 한 개의 복사본만 생성한다.
  - 복사본은 서버들 중, 하나에만 도착

> IPv6는 애니캐스팅을 위해 블록을 지정하지 않는다
- 애니캐스트 주소들은 유니캐스트 블록으로부터 할당된다.
   - IPv6는 `Unicast` 블록을 이용해 `Anicast`를 사용

위 설명으로만으로는 잘 이해가 되지 않을 것이다.
우리가 자주 사용하는 로드 밸런싱을 생각하면 바로 이해가 될 것이다.

**사용 목적**

1. 트래픽 로드 밸런싱


![](https://velog.velcdn.com/images/alstjr971/post/61dfb650-8177-489a-98ac-fc31a05bdb6d/image.png)
- 처음에 KR에 DNS 서버가 한 대 존재했다.
- 그런데 KR DNS 서버에 부하가 심해져서 DNS 서버를 다른 곳에도 두고 싶어졌다.
- 그래서 AU에 DNS Server를 두고, 이 IP를 KR의 DNS 서버의 IP와 동일한 것을 사용한다.

- 그럼 UK, US는 애니캐스트 IP 주소를 가진 목적지로 요청을 보내게 된다.
- 이제 애니캐스트 주소를 가진 그룹 멤버 중에서, 가장 접근이 쉬운(가까운) 서버에게 패킷의 복사본이 전달되는 것이다.

2. 네트워크 리던던시(Network Redundancy)
![](https://velog.velcdn.com/images/alstjr971/post/426fdc0a-1c2f-45f8-b9cb-d4e0ea556cb6/image.png)

3. DDoS 공격 완화
4. 클라이언트-서버 간 거리를 줄여 응답 시간 단축

### 브로드캐스트와 멀티캐스팅

IPv4와 달리, IPv6는 브로드캐스팅 주소를 따로 정의하지 않았다.
뒤에서 설명하겠지만, IPv6는 브로드캐스팅을 멀티캐스팅의 `특별한 경우`로 생각한다.

---

# 🎯주소 공간 할당
IPv4 주소 공간과 마찬가지로, IPv6의 주소 공간은 다양한 크기의 몇 개의 블록으로 나누어지며, 각 블록은 특별한 목적을 위해 할당된다.

- 대부분의 블록들은 `미래 사용을 위해` 할당되지 않았다.



![](https://velog.velcdn.com/images/alstjr971/post/ebec5f1c-e460-4d0a-9349-960329980ea9/image.png)


주소 공간에 있는 각 블록의 할당과 위치에 대한 이해를 위해, 전체 주소 공간을 8등분 범위로 나눈 그림이다.

이 구분은 블록 할당을 보여주진 않지만, 각 실제 블록이 어디에 위치해 있는지를 보여준다.

`Global Unicast`
- 노란 색으로 칠해진 구역은 유니 캐스트 통신을 위해 사용되는데, 이는 단지 주소 공간의 극히 일부(1/8 블록)만이 전역 유니캐스트 통신을 위해 사용될 수 수 있음을 보여준다.(이 정도만 할당해놔도 아무런 문제가 없다는 뜻)

- 2^128 / 2^3 = 2^125 개의 주소를 사용 가능

할당된 블록들을 찾기 위한 알고리즘은 다음과 같다.
![](https://velog.velcdn.com/images/alstjr971/post/1a2fab00-f592-4641-a8c6-989c7f9ebe81/image.png)

## 할당 및 예약된 블록

![](https://velog.velcdn.com/images/alstjr971/post/ebec5f1c-e460-4d0a-9349-960329980ea9/image.png)

맨 앞 블록과 맨 뒤 블록인 Reserved/Assigend 라고 되어 있다.

## 1️⃣ IPv4 호환 주소

**프리픽스 `00000000`을 사용하는 주소들은 예약되어 있지만, 일부분은 IPv4 호환 주소들을 정의하기 위해 사용된다.**

- 이 블록은 전체 주소의 1/256을 사용한다
- CIDR 표기는 0000::/8

### 1. 불특정 주소
- 전체 주소가 0으로 구성
- 호스트가 자신의 주소를 모르고 주소를 찾기 위해 질의를 송신하려는 경우, 부트스트랩동안에 사용
- 이와 같은, 단일 주소 서브블록을 위한 CIDR 표기법은 ::/128

> 이 주소는 절대로 목적지 주소로 사용되어서는 안된다.

![](https://velog.velcdn.com/images/alstjr971/post/b3d8f68b-5dee-4d94-a6c0-b71289932c65/image.png)

🔥IPv4의 불특정 주소와 IPv6의 불특정 주소 비교

- 둘 다 모든 비트가 0인 주소임
- IPv4에서는 A 클래스의 일부분
- IPv6에서는 예약된 블록의 일부분
  - IPv4 에서 0.0.0.0/8 대역의 2^24 호스트 주소는 낭비되고 있다.(IP 주소로 사용 못함 네트워크 마스킹 결과가 all-zero 가 되기 때문)
  - 이러한 낭비를 없애기 위해 예약된 블록을 사용하는 것
  
### 2. 루프백 주소

![](https://velog.velcdn.com/images/alstjr971/post/96786606-a729-4b35-9dda-69de04310a5e/image.png)

이 서브블록 역시 하나의 단일 주소로 구성된다.

이는 네트워크를 통과하지 않고, 자체적으로 테스트하고자 하는 호스트에서 사용되는 주소다.

- CIDR 표기법 : ::1/128 (단일 주소 서브블록)
- 이 주소도 역시 절대로 물리 인터페이스에 할당되어서는 안된다.

🔥IPv4의 루프백 주소와 IPv6의 루프백 주소 비교

1. 클래스기반 주소지정에서는 하나의 전체 블록이 루프백 주소를 위해 할당되지만, IPv6에서는 단지 하나의 주소만 루프백 주소로 사용된다.

2. 클래스기반 주소지정에서 루프백 주소는 클래스 A의 일부분이지만, IPv6에서는 예약된 블록에 있는 하나의 단일주소다.

### 3. 내장된 IPv4 주소

IPv4에서 IPv6로 천이되는 동안, 호스트는 IPv6에 내장된 IPv4 주소를 사용할 수 있어야 한다.

> 두 개의 형식인 `호환`과 `맵`은 이러한 목적으로 설계되었다.

![](https://velog.velcdn.com/images/alstjr971/post/0fb83e7d-f1fc-45b2-99c1-f3fd73b6f0aa/image.png)

### ✅호환 주소(Compatible Address)

![](https://velog.velcdn.com/images/alstjr971/post/f67f558e-0e9f-4b07-8f1a-82520c71a691/image.png)

**호환 주소는 96비트의 0과, 그 뒤에 위치한 32비트 IPv4 주소로 이루어진다.**

`사용 시나리오`

IPv6를 사용하는 컴퓨터가 IPv6를 사용하는 또 다른 컴퓨터에게 메시지를 전송하고자 함

그러나, 패킷이 여전히 IPv4를 사용하는 네트워크 영역을 통과해야 하는 경우도 있다.

송신자는 패킷이 IPv4 영역을 통과할 수 있도록 IPv4 호환 주소를 사용해야 한다.

> 하지만 호환 주소는 치명적인 문제점이 있어 사용되지 않는다.
- IPv6 주소 체계를 사용하는 호스트는 IPv4 영역을 통과해야 하기 때문에 IPv4 주소를 할당받아야 하는 문제

### ✅맵 주소(Mapped Address)

![](https://velog.velcdn.com/images/alstjr971/post/8c8012b7-b66b-42ae-a6ca-b81d8e674021/image.png)

**맵 주소는 80비트의 0과, 그 뒤에 위치한 16비트의 1, 그리고 32  비트의 IPv4 주소로 이루어진다.**

`사용 시나리오`

IPv6를 사용하는 컴퓨터가 여전히 IPv4 주소를 사용하는 컴퓨터에 패킷을 전송하고자 함

패킷은 대부분 IPv6를 통하여 전달되지만, 최종적으로 IPv4를 사용하는 호스트에게 전달됨

> 즉, 맵 주소는 앞에 96비트를 버리고 IPv4 주소를 사용하는 컴퓨터에게 보내진다.
- 호환 주소는 96비트를 버렸다가 다시 붙여서 전달되어야 했음.

---

## 2️⃣  전역 유니캐스트 블록

**인터넷의 호스트 사이에 유니캐스트 통신을 위해 사용되는 주요 블록**

## 3️⃣ 고유 유니캐스트 블록

IPv4 에서는 일부 블록이 사설망 IP 대역으로 예약되어 있다
- 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8

IPv6는 사설망 주소 지정을 위해 하나의 `site` 수준과 하나의 `link` 수준의 두 개의 큰 블록을 사용

![](https://velog.velcdn.com/images/alstjr971/post/cf963841-b5f7-459d-a167-f66a3011044e/image.png)

대학(org) -> 캠퍼스(site) -> 단과대(link) -> ..

## 4️⃣ 링크 로컬 블록

![](https://velog.velcdn.com/images/alstjr971/post/8debd6d6-0bd9-4fe0-8d6a-03d5b99b05c6/image.png)


## 5️⃣ 멀티캐스트 블록

![](https://velog.velcdn.com/images/alstjr971/post/f6f2e5a5-3ee8-4c72-afcc-1532dce94e1d/image.png)

---

# 전역 유니캐스트 주소

# 자동 설정

# IPv6 으로의 천이 과정
